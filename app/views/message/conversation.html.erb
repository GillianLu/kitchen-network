<div class="flex flex-col min-h-screen w-full">
    <div class="h-full w-full pt-20 bg-white">
        <div class='pb-5 h-full w-full flex flex-col'>
            <div class='px-5 pb-5'>
                <%= @conversation_user.first_name %> <%= @conversation_user.last_name %>
            </div>
            <div class='w-full h-full px-5 flex flex-col'>
                <div class='grow flex flex-col justify-end w-full'>
                    <% @message.each do |mess| %>
                        <% if mess.message_sender_id != current_user.id %>
                            <div class='flex py-2'>
                                <div class='bg-linen rounded-lg w-fit p-2'>
                                    <%= mess.content %>
                                </div>
                            </div>
                        <% else %>
                            <div class='flex justify-end py-2'>
                                <div class='bg-lightorange rounded-lg w-fit p-2'>
                                    <%= mess.content %>
                                </div>
                            </div>
                        <% end %>
                    <% end %>
                </div>
                <%= form_with(model: @new_message, url: message_index_path, html: { class: "flex items-center justify-center gap-2 py-1", id: "message-form" }) do |form| %>
                    <div class="field grow">
                        <%= form.text_area :content, class: "form-control resize-none", id: "message-content", placeholder: 'Type something here...' %>
                    </div>
                    <%= form.hidden_field :message_receiver_id, value: @conversation_user.id %>
                <% end %>
            </div>
        </div>
    </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('message-form');
    const textArea = document.getElementById('message-content');
    
    textArea.addEventListener('keydown', function(event) {
      if (event.key === 'Enter' && !event.shiftKey) { 
        event.preventDefault();
        form.submit(); 
      }
    });
  });
</script>
